{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/classCallCheck\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/getPrototypeOf\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/inherits\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport * as React from \"react\";\nimport { getJSON } from \"../shims/ajax\";\nimport Header from \"../components/header\";\nimport BrowseHeader from \"../components/browse-header\";\nimport Body from \"../components/body\";\nimport { Entry } from \"../components/contents\";\n\nvar ViewPage =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ViewPage, _React$Component);\n\n  _createClass(ViewPage, null, [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(context) {\n        var req, query, config, viewPath, BASE_PATH, port, url, xhr;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                req = context.req;\n                query = context.query; // Later, we'll use this to fill in the notebook\n                // file data from the server side (or fallback to /api/contents)\n                // For now, leaving \"server\": boolean to assist in debugging\n                // during the refactor\n                // The best choice will be to rely only on client side for now\n                // I'm sure\n\n                config = {};\n                config.commuterExecuteLink = process.env.COMMUTER_EXECUTE_LINK;\n                viewPath = query.viewPath || \"/\";\n\n                if (req) {\n                  // Server side, communicate with our local API\n                  port = process.env.COMMUTER_PORT || 4000;\n                  BASE_PATH = \"http://127.0.0.1:\".concat(port, \"/\");\n                } else {\n                  BASE_PATH = \"/\";\n                }\n\n                url = \"\".concat(BASE_PATH, \"api/contents/\").concat(viewPath);\n                _context.next = 9;\n                return getJSON(url).toPromise();\n\n              case 9:\n                xhr = _context.sent;\n                return _context.abrupt(\"return\", {\n                  contents: xhr.response,\n                  statusCode: xhr.status,\n                  viewPath: viewPath,\n                  serverConfig: config\n                });\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  function ViewPage(props) {\n    var _this;\n\n    _classCallCheck(this, ViewPage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ViewPage).call(this, props));\n    var config = {};\n\n    if (props.serverConfig) {\n      _this.state = {\n        config: props.serverConfig\n      };\n    } else {\n      var configScriptElement = document.getElementById(\"serverConfig\");\n\n      if (configScriptElement !== null) {\n        config = JSON.parse(configScriptElement.textContent);\n      }\n\n      _this.state = {\n        config: config\n      };\n    }\n\n    return _this;\n  }\n\n  _createClass(ViewPage, [{\n    key: \"render\",\n    value: function render() {\n      if (this.props.statusCode !== 200) {\n        return \"Nothing found for \".concat(this.props.viewPath);\n      }\n\n      return React.createElement(React.Fragment, null, React.createElement(Header, null), React.createElement(BrowseHeader, {\n        basepath: \"/view\",\n        path: this.props.viewPath,\n        type: this.props.contents.type,\n        commuterExecuteLink: this.state.config.commuterExecuteLink\n      }), React.createElement(Body, null, React.createElement(\"div\", {\n        className: \"jsx-3508813217\" + \" \" + \"entry\"\n      }, React.createElement(Entry, {\n        entry: this.props.contents,\n        pathname: this.props.viewPath,\n        basepath: \"/view\"\n      }), React.createElement(_JSXStyle, {\n        id: \"3508813217\"\n      }, \".jsx-3508813217{margin-top:2rem;padding-left:2rem;padding-right:2rem;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3d1dGFsaS9Xb3Jrc3BhY2Uvd3V0YWxpL2NvbW11dGVyL3BhZ2VzL3ZpZXcuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBa0d3QixBQUUrQixnQkFDRSxrQkFDQyxtQkFDckIiLCJmaWxlIjoiL2hvbWUvd3V0YWxpL1dvcmtzcGFjZS93dXRhbGkvY29tbXV0ZXIvcGFnZXMvdmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgZ2V0SlNPTiB9IGZyb20gXCIuLi9zaGltcy9hamF4XCI7XG5pbXBvcnQgSGVhZGVyIGZyb20gXCIuLi9jb21wb25lbnRzL2hlYWRlclwiO1xuaW1wb3J0IEJyb3dzZUhlYWRlciBmcm9tIFwiLi4vY29tcG9uZW50cy9icm93c2UtaGVhZGVyXCI7XG5pbXBvcnQgQm9keSBmcm9tIFwiLi4vY29tcG9uZW50cy9ib2R5XCI7XG5pbXBvcnQgeyBFbnRyeSB9IGZyb20gXCIuLi9jb21wb25lbnRzL2NvbnRlbnRzXCI7XG5cbnR5cGUgU2VydmVyQ29uZmlnID0ge1xuICBjb21tdXRlckV4ZWN1dGVMaW5rPzogc3RyaW5nXG59O1xuXG50eXBlIFZpZXdQYWdlUHJvcHMgPSB7XG4gIGNvbnRlbnRzOiBhbnksXG4gIHN0YXR1c0NvZGU6IGFueSxcbiAgdmlld1BhdGg6IGFueSxcbiAgc2VydmVyQ29uZmlnOiBTZXJ2ZXJDb25maWdcbn07XG5cbnR5cGUgVmlld1BhZ2VTdGF0ZSA9IHtcbiAgY29uZmlnOiBTZXJ2ZXJDb25maWdcbn07XG5cbmNsYXNzIFZpZXdQYWdlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFZpZXdQYWdlUHJvcHMsIFZpZXdQYWdlU3RhdGU+IHtcbiAgc3RhdGljIGFzeW5jIGdldEluaXRpYWxQcm9wcyhjb250ZXh0OiBPYmplY3QpIHtcbiAgICBjb25zdCByZXEgPSBjb250ZXh0LnJlcTtcbiAgICBjb25zdCBxdWVyeSA9IGNvbnRleHQucXVlcnk7XG4gICAgLy8gTGF0ZXIsIHdlJ2xsIHVzZSB0aGlzIHRvIGZpbGwgaW4gdGhlIG5vdGVib29rXG4gICAgLy8gZmlsZSBkYXRhIGZyb20gdGhlIHNlcnZlciBzaWRlIChvciBmYWxsYmFjayB0byAvYXBpL2NvbnRlbnRzKVxuICAgIC8vIEZvciBub3csIGxlYXZpbmcgXCJzZXJ2ZXJcIjogYm9vbGVhbiB0byBhc3Npc3QgaW4gZGVidWdnaW5nXG4gICAgLy8gZHVyaW5nIHRoZSByZWZhY3RvclxuICAgIC8vIFRoZSBiZXN0IGNob2ljZSB3aWxsIGJlIHRvIHJlbHkgb25seSBvbiBjbGllbnQgc2lkZSBmb3Igbm93XG4gICAgLy8gSSdtIHN1cmVcblxuICAgIGNvbnN0IGNvbmZpZyA9IHt9O1xuICAgIGNvbmZpZy5jb21tdXRlckV4ZWN1dGVMaW5rID0gcHJvY2Vzcy5lbnYuQ09NTVVURVJfRVhFQ1VURV9MSU5LO1xuXG4gICAgY29uc3Qgdmlld1BhdGggPSBxdWVyeS52aWV3UGF0aCB8fCBcIi9cIjtcblxuICAgIGxldCBCQVNFX1BBVEg7XG5cbiAgICBpZiAocmVxKSB7XG4gICAgICAvLyBTZXJ2ZXIgc2lkZSwgY29tbXVuaWNhdGUgd2l0aCBvdXIgbG9jYWwgQVBJXG4gICAgICBjb25zdCBwb3J0ID0gcHJvY2Vzcy5lbnYuQ09NTVVURVJfUE9SVCB8fCA0MDAwO1xuICAgICAgQkFTRV9QQVRIID0gYGh0dHA6Ly8xMjcuMC4wLjE6JHtwb3J0fS9gO1xuICAgIH0gZWxzZSB7XG4gICAgICBCQVNFX1BBVEggPSBcIi9cIjtcbiAgICB9XG5cbiAgICBjb25zdCB1cmwgPSBgJHtCQVNFX1BBVEh9YXBpL2NvbnRlbnRzLyR7dmlld1BhdGh9YDtcblxuICAgIGNvbnN0IHhociA9IGF3YWl0IGdldEpTT04odXJsKS50b1Byb21pc2UoKTtcblxuICAgIHJldHVybiB7XG4gICAgICBjb250ZW50czogeGhyLnJlc3BvbnNlLFxuICAgICAgc3RhdHVzQ29kZTogeGhyLnN0YXR1cyxcbiAgICAgIHZpZXdQYXRoLFxuICAgICAgc2VydmVyQ29uZmlnOiBjb25maWdcbiAgICB9O1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFZpZXdQYWdlUHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgbGV0IGNvbmZpZyA9IHt9O1xuICAgIGlmIChwcm9wcy5zZXJ2ZXJDb25maWcpIHtcbiAgICAgIHRoaXMuc3RhdGUgPSB7IGNvbmZpZzogcHJvcHMuc2VydmVyQ29uZmlnIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNvbmZpZ1NjcmlwdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNlcnZlckNvbmZpZ1wiKTtcbiAgICAgIGlmIChjb25maWdTY3JpcHRFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgIGNvbmZpZyA9IEpTT04ucGFyc2UoY29uZmlnU2NyaXB0RWxlbWVudC50ZXh0Q29udGVudCk7XG4gICAgICB9XG4gICAgICB0aGlzLnN0YXRlID0geyBjb25maWcgfTtcbiAgICB9XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuc3RhdHVzQ29kZSAhPT0gMjAwKSB7XG4gICAgICByZXR1cm4gYE5vdGhpbmcgZm91bmQgZm9yICR7dGhpcy5wcm9wcy52aWV3UGF0aH1gO1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgIDxIZWFkZXIgLz5cbiAgICAgICAgPEJyb3dzZUhlYWRlclxuICAgICAgICAgIGJhc2VwYXRoPXtcIi92aWV3XCJ9XG4gICAgICAgICAgcGF0aD17dGhpcy5wcm9wcy52aWV3UGF0aH1cbiAgICAgICAgICB0eXBlPXt0aGlzLnByb3BzLmNvbnRlbnRzLnR5cGV9XG4gICAgICAgICAgY29tbXV0ZXJFeGVjdXRlTGluaz17dGhpcy5zdGF0ZS5jb25maWcuY29tbXV0ZXJFeGVjdXRlTGlua31cbiAgICAgICAgLz5cbiAgICAgICAgPEJvZHk+XG4gICAgICAgICAgey8qIEVudHJ5ICovfVxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZW50cnlcIj5cbiAgICAgICAgICAgIDxFbnRyeVxuICAgICAgICAgICAgICBlbnRyeT17dGhpcy5wcm9wcy5jb250ZW50c31cbiAgICAgICAgICAgICAgcGF0aG5hbWU9e3RoaXMucHJvcHMudmlld1BhdGh9XG4gICAgICAgICAgICAgIGJhc2VwYXRoPXtcIi92aWV3XCJ9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPHN0eWxlIGpzeD57YFxuICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAycmVtO1xuICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDJyZW07XG4gICAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDJyZW07XG4gICAgICAgICAgICBgfTwvc3R5bGU+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvQm9keT5cbiAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBWaWV3UGFnZTtcbiJdfQ== */\\n/*@ sourceURL=/home/wutali/Workspace/wutali/commuter/pages/view.js */\"))));\n    }\n  }]);\n\n  return ViewPage;\n}(React.Component);\n\nexport default ViewPage;","map":{"version":3,"sources":["/home/wutali/Workspace/wutali/commuter/pages/view.js"],"names":["React","getJSON","Header","BrowseHeader","Body","Entry","ViewPage","context","req","query","config","commuterExecuteLink","process","env","COMMUTER_EXECUTE_LINK","viewPath","port","COMMUTER_PORT","BASE_PATH","url","toPromise","xhr","contents","response","statusCode","status","serverConfig","props","state","configScriptElement","document","getElementById","JSON","parse","textContent","type","Component"],"mappings":";;;;;;;;AACA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AAEA,SAASC,OAAT,QAAwB,eAAxB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,YAAP,MAAyB,6BAAzB;AACA,OAAOC,IAAP,MAAiB,oBAAjB;AACA,SAASC,KAAT,QAAsB,wBAAtB;;IAiBMC,Q;;;;;;;;;;gDACyBC,O;;;;;;AACrBC,gBAAAA,G,GAAMD,OAAO,CAACC,G;AACdC,gBAAAA,K,GAAQF,OAAO,CAACE,K,EACtB;AACA;AACA;AACA;AACA;AACA;;AAEMC,gBAAAA,M,GAAS,E;AACfA,gBAAAA,MAAM,CAACC,mBAAP,GAA6BC,OAAO,CAACC,GAAR,CAAYC,qBAAzC;AAEMC,gBAAAA,Q,GAAWN,KAAK,CAACM,QAAN,IAAkB,G;;AAInC,oBAAIP,GAAJ,EAAS;AACP;AACMQ,kBAAAA,IAFC,GAEMJ,OAAO,CAACC,GAAR,CAAYI,aAAZ,IAA6B,IAFnC;AAGPC,kBAAAA,SAAS,8BAAuBF,IAAvB,MAAT;AACD,iBAJD,MAIO;AACLE,kBAAAA,SAAS,GAAG,GAAZ;AACD;;AAEKC,gBAAAA,G,aAASD,S,0BAAyBH,Q;;uBAEtBd,OAAO,CAACkB,GAAD,CAAP,CAAaC,SAAb,E;;;AAAZC,gBAAAA,G;iDAEC;AACLC,kBAAAA,QAAQ,EAAED,GAAG,CAACE,QADT;AAELC,kBAAAA,UAAU,EAAEH,GAAG,CAACI,MAFX;AAGLV,kBAAAA,QAAQ,EAARA,QAHK;AAILW,kBAAAA,YAAY,EAAEhB;AAJT,iB;;;;;;;;;;;;;;;;;;AAQT,oBAAYiB,KAAZ,EAAkC;AAAA;;AAAA;;AAChC,kFAAMA,KAAN;AACA,QAAIjB,MAAM,GAAG,EAAb;;AACA,QAAIiB,KAAK,CAACD,YAAV,EAAwB;AACtB,YAAKE,KAAL,GAAa;AAAElB,QAAAA,MAAM,EAAEiB,KAAK,CAACD;AAAhB,OAAb;AACD,KAFD,MAEO;AACL,UAAMG,mBAAmB,GAAGC,QAAQ,CAACC,cAAT,CAAwB,cAAxB,CAA5B;;AACA,UAAIF,mBAAmB,KAAK,IAA5B,EAAkC;AAChCnB,QAAAA,MAAM,GAAGsB,IAAI,CAACC,KAAL,CAAWJ,mBAAmB,CAACK,WAA/B,CAAT;AACD;;AACD,YAAKN,KAAL,GAAa;AAAElB,QAAAA,MAAM,EAANA;AAAF,OAAb;AACD;;AAX+B;AAYjC;;;;6BAEQ;AACP,UAAI,KAAKiB,KAAL,CAAWH,UAAX,KAA0B,GAA9B,EAAmC;AACjC,2CAA4B,KAAKG,KAAL,CAAWZ,QAAvC;AACD;;AAED,aACE,oBAAC,KAAD,CAAO,QAAP,QACE,oBAAC,MAAD,OADF,EAEE,oBAAC,YAAD;AACE,QAAA,QAAQ,EAAE,OADZ;AAEE,QAAA,IAAI,EAAE,KAAKY,KAAL,CAAWZ,QAFnB;AAGE,QAAA,IAAI,EAAE,KAAKY,KAAL,CAAWL,QAAX,CAAoBa,IAH5B;AAIE,QAAA,mBAAmB,EAAE,KAAKP,KAAL,CAAWlB,MAAX,CAAkBC;AAJzC,QAFF,EAQE,oBAAC,IAAD,QAEE;AAAA,4CAAe;AAAf,SACE,oBAAC,KAAD;AACE,QAAA,KAAK,EAAE,KAAKgB,KAAL,CAAWL,QADpB;AAEE,QAAA,QAAQ,EAAE,KAAKK,KAAL,CAAWZ,QAFvB;AAGE,QAAA,QAAQ,EAAE;AAHZ,QADF;AAAA;AAAA,u3IAFF,CARF,CADF;AA0BD;;;;EAnFoBf,KAAK,CAACoC,S;;AAsF7B,eAAe9B,QAAf","sourcesContent":["// @flow\nimport * as React from \"react\";\n\nimport { getJSON } from \"../shims/ajax\";\nimport Header from \"../components/header\";\nimport BrowseHeader from \"../components/browse-header\";\nimport Body from \"../components/body\";\nimport { Entry } from \"../components/contents\";\n\ntype ServerConfig = {\n  commuterExecuteLink?: string\n};\n\ntype ViewPageProps = {\n  contents: any,\n  statusCode: any,\n  viewPath: any,\n  serverConfig: ServerConfig\n};\n\ntype ViewPageState = {\n  config: ServerConfig\n};\n\nclass ViewPage extends React.Component<ViewPageProps, ViewPageState> {\n  static async getInitialProps(context: Object) {\n    const req = context.req;\n    const query = context.query;\n    // Later, we'll use this to fill in the notebook\n    // file data from the server side (or fallback to /api/contents)\n    // For now, leaving \"server\": boolean to assist in debugging\n    // during the refactor\n    // The best choice will be to rely only on client side for now\n    // I'm sure\n\n    const config = {};\n    config.commuterExecuteLink = process.env.COMMUTER_EXECUTE_LINK;\n\n    const viewPath = query.viewPath || \"/\";\n\n    let BASE_PATH;\n\n    if (req) {\n      // Server side, communicate with our local API\n      const port = process.env.COMMUTER_PORT || 4000;\n      BASE_PATH = `http://127.0.0.1:${port}/`;\n    } else {\n      BASE_PATH = \"/\";\n    }\n\n    const url = `${BASE_PATH}api/contents/${viewPath}`;\n\n    const xhr = await getJSON(url).toPromise();\n\n    return {\n      contents: xhr.response,\n      statusCode: xhr.status,\n      viewPath,\n      serverConfig: config\n    };\n  }\n\n  constructor(props: ViewPageProps) {\n    super(props);\n    let config = {};\n    if (props.serverConfig) {\n      this.state = { config: props.serverConfig };\n    } else {\n      const configScriptElement = document.getElementById(\"serverConfig\");\n      if (configScriptElement !== null) {\n        config = JSON.parse(configScriptElement.textContent);\n      }\n      this.state = { config };\n    }\n  }\n\n  render() {\n    if (this.props.statusCode !== 200) {\n      return `Nothing found for ${this.props.viewPath}`;\n    }\n\n    return (\n      <React.Fragment>\n        <Header />\n        <BrowseHeader\n          basepath={\"/view\"}\n          path={this.props.viewPath}\n          type={this.props.contents.type}\n          commuterExecuteLink={this.state.config.commuterExecuteLink}\n        />\n        <Body>\n          {/* Entry */}\n          <div className=\"entry\">\n            <Entry\n              entry={this.props.contents}\n              pathname={this.props.viewPath}\n              basepath={\"/view\"}\n            />\n            <style jsx>{`\n              margin-top: 2rem;\n              padding-left: 2rem;\n              padding-right: 2rem;\n            `}</style>\n          </div>\n        </Body>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default ViewPage;\n"]},"metadata":{},"sourceType":"module"}